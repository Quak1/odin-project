extends layout

block content
  button#createFolderBtn create folder
  button#uploadBtn upload file
  
  if folder.id
    button#editFolderBtn Edit folder
    h1= folder.name
  if folders.length === 0
    h2 There are no Folders
  else
    ul 
      each folder in folders 
        li
          a(href=`/folder/${folder.id}`)= folder.name
          button.deleteBtn(data-id=folder.id, data-type="folder") Delete

  if files.length === 0
    h2 There are no files
  else
    ul 
      each file in files 
        li: a(href=`/file/${file.id}`)= file.filename

  dialog#newFolderForm: include partials/folderForm
  dialog#uploadFileForm: include partials/fileForm
  if folder.id
    dialog#editFolderForm: include partials/folderEditForm

  script.
    document.getElementById("editFolderBtn")?.addEventListener("click", ()=>{
      document.getElementById("editFolderForm").showModal()
    }) 

    document.getElementById("createFolderBtn").addEventListener("click", ()=>{
      document.getElementById("newFolderForm").showModal()
    }) 

    document.getElementById("uploadBtn").addEventListener("click", ()=>{
      document.getElementById("uploadFileForm").showModal()
    }) 

    document.querySelectorAll(".deleteBtn").forEach((button) =>
      button.addEventListener("click", async () => {
        const type = button.dataset.type;
        const id = button.dataset.id;
        if (confirm(`Are you sure you want to delete this ${type}?`)) {
          const res = await fetch(`/${type}/${id}`, {
            method: "DELETE",
          });
          if (!res.ok) alert(`There was an error deleting this ${type}.`);
          else window.location.reload();
        }
      }),
    );
