<%- include("./partials/head") %>

<main class="genrePage">
    <h1>Genres</h1>
    <ol>
        <% for (const genre of genres) { %>
        <li>
            <form action="/genres/<%= genre.id %>"
                  method="post">
                <input name="genre"
                       id="genre-<%= genre.id %>"
                       type="text"
                       value="<%= genre.genre %>">
                <button type="submit"
                        class="actionButton">Save</button>
                <button class="actionButton deleteBtn"
                        data-id="<%= genre.id %>"
                        type="button">Delete</button>
                <% if (locals.errors?.[genre.id]) { %>
                <label for="genre-<%= genre.id %>">
                    <%= errors[genre.id].msg %>
                </label>
                <% } %>
            </form>
        </li>
        <% } %>
    </ol>

    <% if (genres.length === 0) { %>
    <p>There are no existing genres. Make a new one!</p>
    <% } %>

    <form action="/genres"
          method="post">
        <label for="genre">Add genre</label>
        <input name="genre"
               id="genre"
               value="<%= locals.formData?.genre %>"
               type="text">
        <button type="submit"
                class="actionButton">Add new genre</button>
        <% if (locals.errors?.genre) { %>
        <label for="genre"><%= errors.genre.msg %></label>
        <% } %>
    </form>
</main>

<script>
    document.querySelectorAll(".deleteBtn").forEach((btn) => {
        addDeleteFunction(btn, "genre", () => location.reload())
    })
</script>

<%- include("./partials/footer") %>
